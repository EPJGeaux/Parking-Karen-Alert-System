<!DOCTYPE html>
<html>
<head>
  <title>Karen Radar ðŸš¨</title>
  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body { margin:0; font-family:sans-serif; }
    #map { height:100vh; }
    .leaflet-popup-content { font-family:sans-serif; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Initialize map centered on Houston
    const map = L.map('map').setView([29.7604, -95.3698], 14);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Open Data API URL filtering for your address
    const apiURL = "https://data.houstontx.gov/resource/7x3i-zuj1.json?address=1062 Cheshire Ln";

    // Keep track of seen reports
    const seen = new Set();

    // Marker icon for dramatic effect
    const karenIcon = L.icon({
      iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Red_circle.svg/120px-Red_circle.svg.png',
      iconSize: [20, 20]
    });

    function checkForKarens() {
      fetch(apiURL)
        .then(res => res.json())
        .then(data => {
          data.forEach(f => {
            const id = f.service_request_id;
            if (!seen.has(id)) {
              seen.add(id);

              // Add pin to map
              if (f.latitude && f.longitude) {
                const marker = L.marker([f.latitude, f.longitude], {icon: karenIcon}).addTo(map);
                marker.bindPopup(`
                  <b>ðŸš¨ ${f.sr_type || "Unknown Complaint"} ðŸš¨</b><br>
                  Status: ${f.status || "Unknown"}<br>
                  Reported: ${f.created_date || ""}
                `).openPopup();
              }

              // Optional alert
              alert("ðŸš¨ KAREN ALERT! New complaint for 1062 Cheshire Ln ðŸš¨");
            }
          });
        })
        .catch(err => console.error("API Error:", err));
    }

    // Poll every 30 seconds
    setInterval(checkForKarens, 30000);
    checkForKarens();
  </script>
</body>
</html>
